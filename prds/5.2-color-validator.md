# PRD 5.2: Color & Bit Depth Validator

## Overview
Validate bit depth, color space, and ICC profile requirements.

## Deliverables
- `src/validation/color-validator.ts`

## Interface

```typescript
export interface ColorCheckResult {
  passed: boolean;
  bitDepth?: number;
  colorSpace?: string;
  iccProfile?: string;
  failures: ColorFailure[];
}

export interface ColorFailure {
  check: 'bit_depth' | 'color_space' | 'icc_profile';
  expected: string | number;
  actual?: string | number;
  severity: Severity;
}

export function validateColor(
  exif: ExifData,
  spec: ProjectSpec['color']
): ColorCheckResult;
```

## Validation Logic

### Bit Depth
```typescript
// BitsPerSample can be single value or array
const bitDepth = Array.isArray(exif.BitsPerSample)
  ? exif.BitsPerSample[0]
  : exif.BitsPerSample;

if (spec.bit_depth && bitDepth !== spec.bit_depth) {
  failures.push({
    check: 'bit_depth',
    expected: spec.bit_depth,
    actual: bitDepth,
    severity: 'critical' // can't change bit depth easily
  });
}
```

### Color Space
```typescript
// ColorSpace tag values: 1=sRGB, 2=Adobe RGB, 65535=Uncalibrated
const colorSpaceMap = {
  1: 'sRGB',
  2: 'Adobe RGB (1998)',
  65535: 'Uncalibrated'
};

if (spec.color_space) {
  const actual = colorSpaceMap[exif.ColorSpace] || exif.ColorSpace;
  if (!matchColorSpace(actual, spec.color_space)) {
    failures.push({
      check: 'color_space',
      expected: spec.color_space,
      actual,
      severity: 'fixable' // can convert color space
    });
  }
}
```

### ICC Profile
```typescript
if (spec.icc_profile && exif.ICCProfileName !== spec.icc_profile) {
  failures.push({
    check: 'icc_profile',
    expected: spec.icc_profile,
    actual: exif.ICCProfileName,
    severity: 'fixable'
  });
}
```

## Severity Classification

- Bit depth wrong → **critical** (lossy to change)
- Color space wrong → **fixable** (can convert)
- ICC profile wrong → **fixable** (can embed)

## Color Space Matching

Handle variations:
- "Adobe RGB" = "Adobe RGB (1998)" = "AdobeRGB"
- "sRGB" = "sRGB IEC61966-2.1"

## Success Criteria
- [ ] Check bit depth correctly
- [ ] Check color space with fuzzy matching
- [ ] Check ICC profile
- [ ] Correct severity classification
- [ ] Handle missing EXIF tags
- [ ] Unit tests

## Dependencies
- PRD 1.3 (types)
