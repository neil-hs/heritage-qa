# PRD 2.2: JSON Schema Validator

## Overview
Validate parsed config against JSON Schema + semantic rules.

## Deliverables
- `schemas/config-schema.json` - Full JSON Schema
- `schemas/exif-tags-reference.json` - Valid EXIF tag names
- `src/config/validate-config.ts`

## JSON Schema Structure

```json
{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://heritage-qc.dev/schemas/project-spec.json",
  "title": "Heritage QC Project Specification",
  "type": "object",
  "required": ["project", "format", "validation"],
  "properties": {
    "project": { ... },
    "format": { ... },
    "dimensions": { ... },
    "color": { ... },
    "required_exif": { ... },
    "validation": { ... },
    "naming": { ... }
  }
}
```

See planning doc for full schema.

## Interface

```typescript
export interface ValidationResult {
  valid: boolean;
  errors: ValidationError[];
  warnings: ValidationWarning[];
}

export interface ValidationError {
  path: string;
  message: string;
  value?: unknown;
}

export interface ValidationWarning {
  path: string;
  message: string;
  suggestion?: string;
}

export function validateConfig(config: unknown): Promise<ValidationResult>;
export function validateConfigFile(path: string): Promise<ValidationResult>;
```

## Validation Layers

1. **Schema Validation** (ajv)
   - Required fields
   - Type checking
   - Enum values
   - Format validation (dates)

2. **Semantic Validation** (custom)
   - RAW + run_jhove=true ‚Üí warning
   - Unknown EXIF tags ‚Üí warning with suggestion
   - Unrealistic dimensions (>20000px) ‚Üí warning
   - min > max dimensions ‚Üí error

## CLI Usage

```bash
bun run validate-config project-spec.yaml
```

Output:
```
‚ùå Configuration has errors:
  /color/bit_depth: must be 8, 16, or 32 (got 24)

‚ö†Ô∏è Warnings:
  validation.run_jhove: JHOVE doesn't support RAW
  üí° Set run_jhove: false
```

## Success Criteria
- [ ] Schema validates all fields per planning doc
- [ ] Semantic validation catches logical errors
- [ ] Clear error messages with paths
- [ ] Suggestions for typos (fuzzy match EXIF tags)
- [ ] CLI command works
- [ ] Unit tests for all error cases

## Dependencies
- PRD 1.1 (ajv deps)
- PRD 1.3 (types)
- PRD 2.1 (parser)
