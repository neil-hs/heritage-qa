# PRD 8.2: Filename Validator

## Overview
Validate filenames against naming conventions.

## Deliverables
- `src/validation/filename-validator.ts`

## Interface

```typescript
export interface FilenameCheckResult {
  filepath: string;
  filename: string;
  passed: boolean;
  failures: FilenameFailure[];
}

export interface FilenameFailure {
  rule: FilenameRule;
  message: string;
  severity: Severity;
}

export type FilenameRule =
  | 'pattern'
  | 'spaces'
  | 'special_chars'
  | 'prefix'
  | 'length'
  | 'extension_case';

export function validateFilename(
  filepath: string,
  spec: ProjectSpec['naming']
): FilenameCheckResult;

export function validateFilenames(
  filepaths: string[],
  spec: ProjectSpec['naming']
): FilenameCheckResult[];
```

## Validation Rules

### Pattern Match
```typescript
// spec.naming.pattern: "^[A-Z]{3}_\\d{4}$"
// Valid: ABC_0001.tif
// Invalid: abc_001.tif
if (spec.pattern) {
  const regex = new RegExp(spec.pattern);
  if (!regex.test(basename)) {
    failures.push({
      rule: 'pattern',
      message: `Filename doesn't match pattern: ${spec.pattern}`,
      severity: 'warning'
    });
  }
}
```

### No Spaces
```typescript
// spec.naming.allow_spaces: false
if (!spec.allow_spaces && filename.includes(' ')) {
  failures.push({
    rule: 'spaces',
    message: 'Filename contains spaces',
    severity: 'fixable'
  });
}
```

### Required Prefix
```typescript
// spec.naming.required_prefix: "MUSEUM_"
if (spec.required_prefix && !basename.startsWith(spec.required_prefix)) {
  failures.push({
    rule: 'prefix',
    message: `Missing required prefix: ${spec.required_prefix}`,
    severity: 'fixable'
  });
}
```

### Special Characters
```typescript
const UNSAFE_CHARS = /[<>:"/\\|?*\x00-\x1F]/;
if (UNSAFE_CHARS.test(filename)) {
  failures.push({
    rule: 'special_chars',
    message: 'Filename contains unsafe characters',
    severity: 'fixable'
  });
}
```

### Extension Case
```typescript
// Warn if extension is uppercase: .TIF vs .tif
if (ext !== ext.toLowerCase()) {
  failures.push({
    rule: 'extension_case',
    message: 'Extension should be lowercase',
    severity: 'warning'
  });
}
```

## Severity

- Pattern mismatch → **warning** (may be intentional)
- Spaces → **fixable** (can rename)
- Special chars → **fixable** (can rename)
- Prefix → **fixable** (can rename)

## Success Criteria
- [ ] All validation rules work
- [ ] Regex patterns supported
- [ ] Clear error messages
- [ ] Correct severity
- [ ] Unit tests

## Dependencies
- PRD 1.3 (types)
