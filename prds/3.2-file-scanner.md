# PRD 3.2: File Scanner & Type Detection

## Overview
Scan directories for image files and detect file types.

## Deliverables
- `src/extraction/file-scanner.ts`

## Interface

```typescript
export interface ScanResult {
  matched: FileInfo[];
  mismatched: FileInfo[];
  skipped: string[]; // non-image files
  summary: ScanSummary;
}

export interface FileInfo {
  path: string;
  filename: string;
  extension: string;
  fileType: FileType;
  fileSize: number;
}

export interface ScanSummary {
  totalMatched: number;
  totalMismatched: number;
  totalSkipped: number;
  byType: Record<FileType, number>;
}

export async function scanDirectory(
  dirPath: string,
  config: ProjectSpec
): Promise<ScanResult>;

export function detectFileType(extension: string): FileType | null;
export function isImageFile(extension: string): boolean;
```

## File Type Detection

```typescript
const FILE_TYPE_MAP: Record<string, FileType> = {
  '.tif': 'TIFF',
  '.tiff': 'TIFF',
  '.dng': 'RAW',
  '.arw': 'RAW',
  '.nef': 'RAW',
  '.cr2': 'RAW',
  '.cr3': 'RAW',
  '.orf': 'RAW',
  '.raw': 'RAW',
  '.raf': 'RAW',
  '.rw2': 'RAW',
  '.jpg': 'JPEG',
  '.jpeg': 'JPEG',
  '.png': 'PNG'
};
```

## Behavior

1. Recursively scan directory (optional depth limit)
2. Filter by `config.format.allowed_extensions`
3. Detect file type from extension
4. Report mismatched files (images not in allowed list)
5. Skip non-image files silently
6. Return sorted by filename

## Mismatch Warning

When `enforce_single_type: true`:
```
⚠️ Found 46 DNG files (RAW) in TIFF directory
   These will be skipped.
```

## Success Criteria
- [ ] Scans nested directories
- [ ] Correctly detects all file types
- [ ] Respects allowed_extensions filter
- [ ] Reports mismatches
- [ ] Handles symlinks (follow or skip, configurable)
- [ ] Performance: 10,000 files in <5s
- [ ] Unit tests

## Dependencies
- PRD 1.1 (project setup)
- PRD 1.3 (FileType, FileInfo types)
