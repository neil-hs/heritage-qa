# PRD 8.3: Validation Comparison Tool

## Overview
Compare two validation runs to show improvements/regressions.

## Deliverables
- `src/utils/compare-validations.ts`

## Interface

```typescript
export interface ComparisonResult {
  runA: { id: number; version: number };
  runB: { id: number; version: number };
  summary: {
    fixed: number;
    newFailures: number;
    unchanged: number;
    netChange: number;
  };
  fixed: ImageComparison[];
  newFailures: ImageComparison[];
  stillFailing: ImageComparison[];
}

export interface ImageComparison {
  filepath: string;
  filename: string;
  statusA: ValidationStatus;
  statusB: ValidationStatus;
  failuresA: string[];
  failuresB: string[];
}

export async function compareRuns(
  db: Database,
  runIdA: number,
  runIdB: number
): Promise<ComparisonResult>;
```

## Comparison Logic

```typescript
For each image:
  statusA = getStatus(runA)
  statusB = getStatus(runB)

  if (statusA === 'fail' && statusB === 'pass'):
    → fixed
  elif (statusA === 'pass' && statusB === 'fail'):
    → newFailure
  elif (statusA === 'fail' && statusB === 'fail'):
    → stillFailing
  else:
    → unchanged
```

## Output Format

```
Comparing v1 → v2

Summary:
  ✓ Fixed: 64 images
  ✗ New failures: 2 images
  → Still failing: 25 images
  Net change: +62 improvements

Fixed Images:
  IMG_0100.tif: Missing Artist → ✓
  IMG_0101.tif: Missing Artist → ✓
  ...

New Failures:
  IMG_0500.tif: ✓ → Dimension below minimum

Still Failing:
  IMG_0023.tif: Dimension below minimum (unchanged)
  ...
```

## Use Cases

1. **After applying fixes**
   - Compare v1 → v2 to verify fixes worked

2. **After re-scanning**
   - Verify dimension issues resolved

3. **Regression detection**
   - Catch accidental new issues

## Success Criteria
- [ ] Correct comparison logic
- [ ] Shows fixed, new, unchanged
- [ ] Per-image detail available
- [ ] Handles missing images (deleted/added)
- [ ] Unit tests

## Dependencies
- PRD 1.2 (database)
