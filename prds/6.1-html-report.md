# PRD 6.1: HTML Report Generator

## Overview
Generate interactive HTML report with embedded database for offline querying.

## Deliverables
- `src/reporting/html-report.ts`
- `src/reporting/templates/report.html` - HTML template
- `assets/sql-wasm.js` - Bundled SQL.js (for air-gapped environments)
- `assets/sql-wasm.wasm` - SQL.js WASM binary

## Interface

```typescript
export interface HtmlReportOptions {
  outputPath: string;
  title?: string;
  includeDatabase?: boolean; // embed SQL.js, default true
  theme?: 'light' | 'dark';
}

export async function generateHtmlReport(
  db: Database,
  runId: number,
  options: HtmlReportOptions
): Promise<string>; // returns output path
```

## Report Sections

1. **Summary Dashboard**
   - Total images, pass/fail counts
   - Pie chart by severity
   - Bar chart by check type

2. **Failed Images Table**
   - Sortable, filterable
   - Columns: filename, failures, severity
   - Click to expand details

3. **Passed Images** (collapsible)
   - List of passing files

4. **Configuration Used**
   - Show spec YAML

5. **Interactive Query** (if includeDatabase)
   - SQL.js embedded
   - Run custom queries
   - Export results

## HTML Template Structure

```html
<!DOCTYPE html>
<html>
<head>
  <title>Validation Report - {{project_name}}</title>
  <style>/* Embedded CSS */</style>
</head>
<body>
  <header>
    <h1>{{project_name}}</h1>
    <p>Run: v{{version}} | {{date}}</p>
  </header>

  <section id="summary">
    <!-- Dashboard widgets -->
  </section>

  <section id="failures">
    <table id="failed-images"><!-- Data --></table>
  </section>

  <section id="passed" class="collapsed">
    <!-- Passed files list -->
  </section>

  <section id="config">
    <pre>{{config_yaml}}</pre>
  </section>

  <section id="query">
    <!-- SQL.js interface -->
  </section>

  <!-- SQL.js loaded from local bundle, NOT CDN -->
  <script src="./assets/sql-wasm.js"></script>
  <script>/* Query interface */</script>
</body>
</html>
```

## Offline Capability (Air-Gapped Archives)

**Critical**: Many archives operate in air-gapped environments with no internet.

- All CSS/JS inline or bundled locally
- **SQL.js bundled locally** (sql-wasm.js + sql-wasm.wasm copied to report directory)
- Database embedded as base64 or JSON
- Zero external network requests
- Report is fully self-contained

### Bundling Strategy

```typescript
async function generateReport(options: HtmlReportOptions) {
  // Copy SQL.js assets alongside report
  await copyFile('assets/sql-wasm.js', `${outputDir}/assets/sql-wasm.js`);
  await copyFile('assets/sql-wasm.wasm', `${outputDir}/assets/sql-wasm.wasm`);

  // Generate HTML with relative paths
  const html = template.replace('{{sql_js_path}}', './assets/sql-wasm.js');
}
```

## Success Criteria
- [ ] Generates valid HTML
- [ ] Works offline
- [ ] Tables sortable/filterable
- [ ] SQL queries work (if enabled)
- [ ] Responsive design
- [ ] <5 seconds generation for 1000 images

## Dependencies
- PRD 1.2 (database queries)
- PRD 5.4 (validation results)
