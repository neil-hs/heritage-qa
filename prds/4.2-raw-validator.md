# PRD 4.2: RAW File Validator

## Overview
Basic validity checks for RAW camera files (JHOVE doesn't support RAW).

## Deliverables
- `src/validation/raw-validator.ts`

## Interface

```typescript
export interface RawValidationResult {
  filepath: string;
  valid: boolean;
  format: string; // DNG, ARW, NEF, etc.
  checks: RawCheck[];
}

export interface RawCheck {
  name: string;
  passed: boolean;
  message?: string;
}

export async function validateRaw(
  filepath: string,
  exifData?: ExifData
): Promise<RawValidationResult>;

export async function validateRawBatch(
  files: Array<{ path: string; exif?: ExifData }>
): Promise<Map<string, RawValidationResult>>;
```

## Validation Checks

1. **File Readable**
   - Can open file without error
   - File size > 0

2. **Has EXIF Data**
   - ExifTool returns data
   - Contains basic tags (Make, Model)

3. **Expected Format Match**
   - Extension matches detected format
   - DNG header validation (if DNG)

4. **Not Corrupt**
   - ExifTool doesn't report errors
   - File doesn't truncate unexpectedly

## Check Implementation

```typescript
const RAW_CHECKS = [
  {
    name: 'file_readable',
    check: async (path) => {
      const file = Bun.file(path);
      return file.size > 0;
    }
  },
  {
    name: 'has_exif',
    check: async (path, exif) => {
      return exif && Object.keys(exif).length > 0;
    }
  },
  {
    name: 'has_dimensions',
    check: async (path, exif) => {
      return exif?.ImageWidth && exif?.ImageHeight;
    }
  },
  {
    name: 'camera_metadata',
    check: async (path, exif) => {
      return exif?.Make || exif?.Model;
    }
  }
];
```

## DNG-Specific Checks (Future)

- Valid DNG header bytes
- DNGVersion tag present
- DNGBackwardVersion tag present

## Success Criteria
- [ ] Validate all supported RAW formats
- [ ] Detect corrupt files
- [ ] Work with pre-extracted EXIF (efficiency)
- [ ] Clear pass/fail per check
- [ ] Unit tests with fixtures

## Dependencies
- PRD 1.3 (types)
- PRD 3.1 (exiftool - for EXIF extraction if needed)
